# Protocol

## Purpose

Tldr; the whole point of the protocol package is to define data than can be send around by decoupled components of this app:

- orchestrator
- agents
- ui

Communication between orchestrator and it's services should not be defined here.

## Principles

- Underlying transport protocol is not defined in this package (at least for now), but data should be defined here

### UI <-> Orchestrator

- The interaction from UI to Orchestrator should always be a Command (see protocol/commands.go)
- The interaction from Orchestrator to UI should always be an Event (see protocol/events.go)
- Both Commands and Events embed BaseMessage for correlation tracking and versioning

### Orchestrator <-> Agents

- The interaction between Orchestrator and Agents should always be a Signal (see protocol/signals.go)
- Signals do not need correlation IDs as they operate within Temporal's tracking system

### UI <-> Agents

- This communication never happens directly. UI must always go through orchestrator
- Orchestrator must translate UI commands to Signals, and then Signals to Events

## Protocol Structure

### Base Message (protocol/base.go)

All messages that interact with the UI (Commands and Events) embed the `BaseMessage` struct which provides:

- **CorrelationID**: A unique identifier generated by the UI to track the entire lifecycle of a command through to its resulting events
- **Version**: Protocol version for backward compatibility (format: "v{major}.{minor}.{patch}")

### Correlation Flow

1. UI generates a unique CorrelationID when creating a Command
2. Orchestrator maintains the CorrelationID throughout the command processing
3. All Events sent back to the UI include the original CorrelationID
4. This allows the UI to match responses with their originating requests, even in async flows

### Versioning Strategy

- Current protocol version is defined in `CurrentProtocolVersion` constant
- All Commands and Events include version information
- Enables graceful protocol evolution and backward compatibility